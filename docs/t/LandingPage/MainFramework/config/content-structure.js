// 内容结构配置文件 - 只包含路径和级别信息
// 每个页面的id和title将从各自的CSS文件中提取

// 定义页面路径和级别
const pageStructure = [
    {
        path: 'Pages/1/1',
        level: 1
    },
    // 新创建的页面 2-93
    {
        path: 'Pages/2/2',
        level: 1
    },
    {
        path: 'Pages/3/3',
        level: 2
    },
    {
        path: 'Pages/4/4',
        level: 2
    },
    {
        path: 'Pages/5/5',
        level: 2
    },
    {
        path: 'Pages/6/6',
        level: 2
    },
    {
        path: 'Pages/7/7',
        level: 2
    },
    {
        path: 'Pages/8/8',
        level: 2
    },
    {
        path: 'Pages/9/9',
        level: 2
    },
    {
        path: 'Pages/10/10',
        level: 2
    },
    {
        path: 'Pages/11/11',
        level: 2
    },
    {
        path: 'Pages/12/12',
        level: 2
    },
    {
        path: 'Pages/13/13',
        level: 2
    },
    {
        path: 'Pages/14/14',
        level: 2
    },
    {
        path: 'Pages/15/15',
        level: 2
    },
    {
        path: 'Pages/16/16',
        level: 2
    },
    {
        path: 'Pages/17/17',
        level: 2
    },
    {
        path: 'Pages/18/18',
        level: 2
    },
    {
        path: 'Pages/19/19',
        level: 2
    },
    {
        path: 'Pages/20/20',
        level: 2
    },
    {
        path: 'Pages/21/21',
        level: 2
    },
    {
        path: 'Pages/22/22',
        level: 2
    },
    {
        path: 'Pages/23/23',
        level: 2
    },
    {
        path: 'Pages/24/24',
        level: 2
    },
    {
        path: 'Pages/25/25',
        level: 2
    },
    {
        path: 'Pages/26/26',
        level: 2
    },
    {
        path: 'Pages/27/27',
        level: 2
    },
    {
        path: 'Pages/28/28',
        level: 2
    },
    {
        path: 'Pages/29/29',
        level: 2
    },
    {
        path: 'Pages/30/30',
        level: 2
    },
    {
        path: 'Pages/31/31',
        level: 2
    },
    {
        path: 'Pages/32/32',
        level: 2
    },
    {
        path: 'Pages/33/33',
        level: 2
    },
    {
        path: 'Pages/34/34',
        level: 2
    },
    {
        path: 'Pages/35/35',
        level: 2
    },
    {
        path: 'Pages/36/36',
        level: 2
    },
    {
        path: 'Pages/37/37',
        level: 2
    },
    {
        path: 'Pages/38/38',
        level: 2
    },
    {
        path: 'Pages/39/39',
        level: 2
    },
    {
        path: 'Pages/40/40',
        level: 2
    },
    {
        path: 'Pages/41/41',
        level: 2
    },
    {
        path: 'Pages/42/42',
        level: 2
    },
    {
        path: 'Pages/43/43',
        level: 2
    },
    {
        path: 'Pages/44/44',
        level: 2
    },
    {
        path: 'Pages/45/45',
        level: 2
    },
    {
        path: 'Pages/46/46',
        level: 2
    },
    {
        path: 'Pages/47/47',
        level: 2
    },
    {
        path: 'Pages/48/48',
        level: 2
    },
    {
        path: 'Pages/49/49',
        level: 2
    },
    {
        path: 'Pages/50/50',
        level: 2
    },
    {
        path: 'Pages/51/51',
        level: 2
    },
    {
        path: 'Pages/52/52',
        level: 2
    },
    {
        path: 'Pages/53/53',
        level: 2
    },
    {
        path: 'Pages/54/54',
        level: 2
    },
    {
        path: 'Pages/55/55',
        level: 2
    },
    {
        path: 'Pages/56/56',
        level: 2
    },
    {
        path: 'Pages/57/57',
        level: 2
    },
    {
        path: 'Pages/58/58',
        level: 1
    },
    {
        path: 'Pages/59/59',
        level: 2
    },
    {
        path: 'Pages/60/60',
        level: 2
    },
    {
        path: 'Pages/61/61',
        level: 2
    },
    {
        path: 'Pages/62/62',
        level: 2
    },
    {
        path: 'Pages/63/63',
        level: 2
    },
    {
        path: 'Pages/64/64',
        level: 2
    },
    {
        path: 'Pages/65/65',
        level: 2
    },
    {
        path: 'Pages/66/66',
        level: 2
    },
    {
        path: 'Pages/67/67',
        level: 2
    },
    {
        path: 'Pages/68/68',
        level: 2
    },
    {
        path: 'Pages/69/69',
        level: 2
    },
    {
        path: 'Pages/70/70',
        level: 2
    },
    {
        path: 'Pages/71/71',
        level: 2
    },
    {
        path: 'Pages/72/72',
        level: 2
    },
    {
        path: 'Pages/73/73',
        level: 2
    },
    {
        path: 'Pages/74/74',
        level: 2
    },
    {
        path: 'Pages/75/75',
        level: 2
    },
    {
        path: 'Pages/76/76',
        level: 2
    },
    {
        path: 'Pages/77/77',
        level: 2
    },
    {
        path: 'Pages/78/78',
        level: 2
    },
    {
        path: 'Pages/79/79',
        level: 2
    },
    {
        path: 'Pages/80/80',
        level: 2
    },
    {
        path: 'Pages/81/81',
        level: 2
    },
    {
        path: 'Pages/82/82',
        level: 2
    },
    {
        path: 'Pages/83/83',
        level: 2
    },
    {
        path: 'Pages/84/84',
        level: 2
    },
    {
        path: 'Pages/85/85',
        level: 2
    },
    {
        path: 'Pages/86/86',
        level: 2
    },
    {
        path: 'Pages/87/87',
        level: 2
    },
    {
        path: 'Pages/88/88',
        level: 2
    },
    {
        path: 'Pages/89/89',
        level: 2
    },
    {
        path: 'Pages/90/90',
        level: 2
    },
    {
        path: 'Pages/91/91',
        level: 2
    },
    {
        path: 'Pages/92/92',
        level: 2
    },
    {
        path: 'Pages/93/93',
        level: 2
    }
];

// 从 CSS 文件中提取元数据
function extractMetadataFromCSS(cssContent) {
    // 默认元数据
    let metadata = {
        id: '',
        title: ''
    };
    
    // 匹配元数据注释块
    const metadataMatch = cssContent.match(/\/\* PAGE_METADATA\s*\n([\s\S]*?)\*\//i);
    
    if (metadataMatch && metadataMatch[1]) {
        // 提取 id
        const idMatch = metadataMatch[1].match(/\*\s*id:\s*([^\n]*)/i);
        if (idMatch && idMatch[1]) {
            metadata.id = idMatch[1].trim();
        }
        
        // 提取 title
        const titleMatch = metadataMatch[1].match(/\*\s*title:\s*([^\n]*)/i);
        if (titleMatch && titleMatch[1]) {
            metadata.title = titleMatch[1].trim();
        }
    }
    
    return metadata;
}

// 加载 CSS 文件内容
async function loadCSSContent(path) {
    try {
        const response = await fetch(path);
        if (!response.ok) {
            throw new Error(`Failed to load CSS: ${response.status} ${response.statusText}`);
        }
        return await response.text();
    } catch (error) {
        console.error(`Error loading CSS from ${path}:`, error);
        return '';
    }
}

// 加载页面元数据并构建完整的内容结构
async function loadContentStructureAsync() {
    const contentStructure = [];
    
    // 遍历所有页面结构
    for (const page of pageStructure) {
        const pathParts = page.path.split('/');
        const pageName = pathParts[pathParts.length - 1];
        const cssPath = `${page.path}.css`;
        
        // 加载 CSS 文件
        const cssContent = await loadCSSContent(cssPath);
        
        // 从 CSS 文件中提取元数据
        const metadata = extractMetadataFromCSS(cssContent);
        
        // 构建完整的页面对象
        const pageObject = {
            id: metadata.id || pageName, // 如果没有提取到 id，则使用页面名称
            title: metadata.title || pageName, // 如果没有提取到 title，则使用页面名称
            path: `${page.path}.html`,
            level: page.level
        };
        
        // 将页面对象添加到内容结构中
        contentStructure.push(pageObject);
    }
    
    return contentStructure;
}

// 初始化内容结构数组
let contentStructure = [];

// 当文档加载完成后加载内容结构
document.addEventListener('DOMContentLoaded', async function() {
    contentStructure = await loadContentStructureAsync();
    
    // 触发自定义事件，通知 main.js 内容结构已加载完成
    const event = new CustomEvent('contentStructureLoaded', { detail: { contentStructure } });
    document.dispatchEvent(event);
});
